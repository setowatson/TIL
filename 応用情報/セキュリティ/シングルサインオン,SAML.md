
## 🔐 シングルサインオン方式の比較表

| 比較項目                  | クッキーを使用するSSO                     | リバースプロキシを使用するSSO                     | SAMLを使用するSSO                                 |
|---------------------------|-------------------------------------------|---------------------------------------------------|---------------------------------------------------|
| **基本的な仕組み**        | 認証後に発行される**ブラウザクッキー**を共有 | **共通のリバースプロキシ**が各サービスに前段配置される | **SAMLトークン**を使って認証情報をやりとりする     |
| **共通ドメインが必要？**  | ✅ **必要**（例: `*.example.com`）          | ❌ 不要（プロキシが認証制御するため）               | ❌ 不要（プロトコルで連携する）                    |
| **ブラウザ制約**          | ブラウザがクッキーを受け入れる必要あり     | 特になし（プロキシ経由のアクセス制御）             | 特になし（HTTPリダイレクトでやり取り）            |
| **認証の可視性**          | クライアントのブラウザが認証情報を保持     | クライアントからは**認証の存在を意識しにくい**      | クライアントが**リダイレクトされる**動作が見える    |
| **実装の複雑さ**          | 比較的シンプル                              | インフラ構成が複雑になりがち                        | 設定・プロトコル理解がやや難                       |
| **代表的な用途**          | 社内Webアプリの統合                        | 既存のレガシーアプリへのSSO追加                     | エンタープライズSaaS（Google Workspace等）         |
| **セキュリティ面**        | クッキー盗聴やスコープ外利用に注意         | 通信の中間者（MITM）対策が重要                     | 強固な認証連携（署名・証明書利用）                 |
| **認証方式の例**          | セッションID、JWT                          | プロキシでLDAP認証 → 認証済みのみバックエンドへ     | IdPとSP間での証明書付きトークン                    |
| **拡張性・相互運用性**    | ドメイン制約ありで限定的                   | 構成依存で中程度                                   | 🌍 高い（異なるサービスや組織間でも連携可能）       |

---

## 💡ざっくり使い分けイメージ

- 🧁 **クッキー方式**：  
　→ 同一ドメイン内の複数アプリをまとめてログインさせたいときに手軽  
　例：`mail.example.com`、`chat.example.com`

- 🛡️ **リバースプロキシ方式**：  
　→ アプリを改修せずSSOを実現したいときに便利  
　例：Apache＋mod_auth、NGINX＋OpenRestyなど

<img width="991" alt="image" src="https://github.com/user-attachments/assets/55060fc7-caab-4ec2-8f56-d2cd6d2c1325" />

- 🌐 **SAML方式**：  
　→ 異なるドメイン・異なる企業・クラウドサービスをまたぐ場合に強力  
　例：Azure ADやGoogle Workspaceと外部SaaSの連携

---




## 🧩 SAML / OAuth / OpenID Connect（OIDC）の違いまとめ表

| 比較項目              | **SAML**                         | **OAuth 2.0**                        | **OpenID Connect（OIDC）**              |
|-----------------------|----------------------------------|--------------------------------------|------------------------------------------|
| **目的**              | 認証（ユーザーが誰かを証明）     | 認可（何を許可するか）               | 認証 + 認可（ユーザーの特定＋アクセス）|
| **主な用途**          | エンタープライズSSO              | APIアクセス制御（例：連携アプリ）     | Web / モバイルアプリのSSO & API連携     |
| **プロトコル形式**    | XMLベース                        | JSON + HTTP                          | OAuth 2.0に**IDトークンの拡張**を追加    |
| **やりとり形式**      | SAMLアサーション（XML）         | アクセストークン（Bearer Token）     | IDトークン（JWT形式） + アクセストークン |
| **クライアント種類**  | 主にWebブラウザベース            | Web/ネイティブ/スクリプトアプリ等   | Web/ネイティブ/SPAなど幅広く対応        |
| **認証情報の扱い**    | 認証結果（SAML Assertion）を返す| アクセス許可だけで**ユーザー情報は含まない**| IDトークンで**ユーザー情報を含めて返す**  |
| **代表的な使用例**    | Google Workspace, Azure AD連携  | Facebook/TwitterのAPI連携など        | Google Login, LINEログインなど          |
| **セキュリティ特徴**  | XML署名・証明書                  | トークンのスコープと有効期限制御     | JWT署名付きIDトークン                    |
| **相互運用性**        | 組織間のSSO（B2B/B2E向け）        | B2C向けAPI許可制御                   | B2C向けSSO + APIアクセスに便利          |

---

## 🔑 わかりやすく例えるなら…

| プロトコル       | 例えるなら…                                               |
|------------------|------------------------------------------------------------|
| **SAML**         | 🔐 社員証を提示して会社ビルに入る（組織向けの重厚な仕組み）   |
| **OAuth 2.0**    | 📝「このアプリにはTwitterのフォロー一覧**だけ**見せてOK」      |
| **OIDC**         | 🪪「この人は◯◯さんです」とログインID付き社員証を発行（APIでもSSOにもOK）|

---

## 💡どう使い分ければいいの？

- 👔 **企業内SSO** → SAMLが多い（Azure AD・社内ポータルなど）
- 📲 **モバイル/SPAなど軽量Webアプリ** → OIDC一択（GoogleやLINEログイン）
- 🔌 **API連携・外部サービス許可** → OAuthがベース（Twitter連携など）
