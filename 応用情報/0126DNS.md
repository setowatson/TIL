
## DNS（Domain Name System）

**DNS**は、ドメイン名とIPアドレスを相互に変換するインターネットの仕組みです。人が覚えやすいドメイン名（例: `example.com`）を、コンピュータが通信に使用するIPアドレス（例: `192.0.2.1`）に解決します。



### DNSの仕組み

1. **クライアント（例: ブラウザ）からのリクエスト**  
   - ユーザーがウェブサイトのURLを入力すると、DNSリゾルバにドメイン名のIPアドレス解決を依頼します。

2. **DNSリゾルバの処理**  
   - DNSリゾルバはキャッシュされたデータを確認し、なければ権威DNSサーバに問い合わせを行います。

3. **権威DNSサーバの応答**  
   - 権威DNSサーバがドメイン名に対応するIPアドレスを返し、ユーザーのデバイスはそのアドレスにアクセスします。


## DNSキャッシュポイズニング

**DNSキャッシュポイズニング**は、攻撃者がDNSリゾルバのキャッシュに偽のデータを注入し、ユーザーを悪意のあるサイトに誘導する攻撃手法です。


### DNSキャッシュポイズニングの仕組み

1. **攻撃の準備**  
   - 攻撃者は、特定のドメイン名に対応するIPアドレスを偽装したDNS応答を作成します。

2. **偽の応答を注入**  
   - 攻撃者がDNSリゾルバに問い合わせを行い、その応答に偽のデータを混入させます。
   - DNSリゾルバがその偽のデータをキャッシュとして保存してしまうと、他のユーザーにも偽情報が提供されます。

3. **ユーザーの誘導**  
   - 攻撃者が指定した悪意のあるIPアドレスにユーザーがアクセスさせられ、フィッシングサイトやマルウェア感染に繋がります。


## DNSキャッシュポイズニングの影響

- **フィッシング詐欺**  
  - 銀行やオンラインショップの偽サイトに誘導され、個人情報を盗まれる。
- **マルウェア感染**  
  - 偽サイトから悪意のあるファイルが配布され、デバイスが感染する。
- **信頼性の低下**  
  - DNSの仕組み全体への不信感が広がる。


### DNSキャッシュポイズニングへの対策

1. **DNSSECの導入**  
   - DNS応答にデジタル署名を追加し、応答データの改ざんを防止します。
   
2. **ソースポートランダム化**  
   - DNSリクエストの送信元ポートをランダム化することで、攻撃者が偽の応答を一致させることを難しくします。

3. **キャッシュデータの有効期限短縮**  
   - DNSキャッシュの有効期限を短く設定し、古いキャッシュデータの使用を防ぎます。


## DNSSEC（DNS Security Extensions）

- **DNSSECはDNSにおけるデジタル署名を利用したセキュリティ拡張機能**。
- DNSが返す応答データに電子署名を付与し、そのデータが改ざんされていないことを保証。


### DNSSECの特徴

1. **デジタル署名によるデータ保護**
   - DNSサーバが提供するデータに対して公開鍵暗号方式を用いて署名します。
   - クライアントは署名を検証することで、そのデータが権威DNSサーバから正しく取得されたものか確認します。

2. **データの完全性保証**
   - 攻撃者がデータを改ざんしても、署名が一致しないため検知可能です。

3. **中間者攻撃やDNSキャッシュポイズニングへの耐性**
   - DNSSECは改ざんされた応答を排除できるため、攻撃の成功を防ぎます。


### DNSSECとDKIM/SPFの違い

DKIM（DomainKeys Identified Mail）とSPF（Sender Policy Framework）は、**メール送信の信頼性を保証する仕組み**であり、DNSSECとは目的や適用範囲が異なります。

| **項目**         | **DNSSEC**                                                                                                                                  | **DKIM**                                                                                                          | **SPF**                                                                                  |
|-------------------|--------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------|
| **対象**         | DNS（ドメイン名とIPアドレスなどのデータ）                                                                                                   | メール（送信者が改ざんされていないことを確認）                                                                     | メール（送信元サーバが許可されたものかを確認）                                           |
| **目的**         | DNS応答データの**完全性保証**と改ざん防止                                                                                                   | メール本文やヘッダーの**改ざん検出**                                                                              | 送信元メールサーバが正規のサーバであることを**検証**                                    |
| **署名の場所**   | DNS応答データ（リソースレコード）                                                                                                           | メールヘッダー                                                                                                    | DNSレコードに「許可されたメールサーバのIPアドレス」などを登録                           |
| **技術**         | デジタル署名（公開鍵暗号方式）                                                                                                              | デジタル署名（公開鍵暗号方式）                                                                                    | DNSレコードによるIPアドレスの照合                                                       |
| **改ざん検知**   | DNS応答データが権威DNSサーバから改ざんされていないことを検証                                                                                 | メール本文・ヘッダーが改ざんされていないことを検証                                                                | メールが正規の送信元サーバから送信されたかを検証                                         |
| **仕組みの範囲** | インターネット全体のDNSシステム                                                                                                             | 個々のメール送信                                                                                                 | ドメインごとのメール送信ポリシー                                                        |
| **適用例**       | DNSキャッシュポイズニングの防止、セキュアなドメイン解決                                                                                     | なりすましメールの防止（送信者アドレスの正当性保証）                                                              | スパムメールやフィッシングメールの防止                                                   |



#### DNSSECの流れ
1. **権威DNSサーバ**は、DNS応答（IPアドレスなど）にデジタル署名を付与。
2. **クライアント**は、権威サーバの公開鍵を用いて署名を検証。
3. 署名が正しければ、データが正当であることを確認。

#### DKIMの流れ
1. **送信者メールサーバ**は、メールの一部（本文やヘッダー）にデジタル署名を付与。
2. 受信者は送信者ドメインのDNSに公開鍵を問い合わせ、署名を検証。
3. 署名が正しければ、メールが改ざんされていないことを確認。

#### SPFの流れ
1. 受信者メールサーバは、送信元IPアドレスを**SPFレコード**と照合。
2. 許可されたサーバからのメールなら正当とみなす。
3. 不一致の場合、メールを拒否またはスパム判定。


## まとめ

- **DNSSEC**はDNSデータにデジタル署名を付与し、DNSシステムの安全性を高める。
- **DKIM**はメールにデジタル署名を付与して改ざん防止を行う。
- **SPF**はDNSを利用して正規のメールサーバを検証する。
