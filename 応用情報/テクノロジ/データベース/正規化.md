

### **正規化の各段階（正規形）**
データベースの正規化は、**第1正規形（1NF）** から **第5正規形（5NF）** までの段階に分かれています。  
一般的なデータベース設計では、**第3正規形（3NF）** または **ボイス・コッド正規形（BCNF）** までを適用することが多いです。  

| **正規形** | **条件** | **主なポイント** | **例（非正規 → 正規化後）** |
|-----------|---------|-----------------|--------------------------------|
| **第1正規形** | **繰り返し要素を排除**（すべての列が単一の値を持つ） | 1つのセルに複数の値を持たない | `{A, B1, B2, B3}` → `{A, B}`（行を分割） |
| **第2正規形** | **1NF** を満たし、**部分関数従属性を排除** | 主キーの一部だけに依存する列を分割 | `{学籍番号, 科目, 学生名}` → `{学籍番号, 学生名}` + `{学籍番号, 科目}` |
| **第3正規形** | **2NF** を満たし、**推移的関数従属性を排除** | 主キーに直接関係しない列を別テーブルへ | `{社員ID, 部署ID, 部署名}` → `{部署ID, 部署名}` を分離 |
| **ボイス・コッド正規形（BCNF）** | **3NF** を満たし、**主キー以外の決定項を排除** | 主キー以外の列がキーを決定しない | `{講師, コース, 教室}` → `{講師, コース}` + `{コース, 教室}` |
| **第4正規形** | **BCNF** を満たし、**多値従属性を排除** | 1つのキーに複数の独立した値を持たない | `{学生, 資格, クラブ}` → `{学生, 資格}` + `{学生, クラブ}` |
| **第5正規形** | **4NF** を満たし、**結合依存を排除** | テーブルを分割しすぎてデータが復元できなくなることを防ぐ | `{A, B, C}` → `{A, B}` + `{B, C}` |

---

### **正規化の具体例**
#### **非正規形（UNF：Unnormalized Form）**
| 注文ID | 商品名 | 個数 | 値段 |
|--------|------|----|----|
| 001 | コーヒー, カップ, スプーン | 1, 2, 1 | 500, 300, 100 |

➡ 1つのセルに**複数の値が含まれているためNG**（第1正規形を満たしていない）

---

#### **第1正規形（1NF）**
| 注文ID | 商品名 | 個数 | 値段 |
|--------|------|----|----|
| 001 | コーヒー | 1 | 500 |
| 001 | カップ | 2 | 300 |
| 001 | スプーン | 1 | 100 |

✅ **1つのセルに1つの値のみ**  
❌ **商品名 → 値段に依存（部分関数従属性）** があるため、第2正規形にする必要あり。

---

#### **第2正規形（2NF）**
【分割後のテーブル】

**注文テーブル**
| 注文ID | 商品ID | 個数 |
|--------|------|----|
| 001 | P001 | 1 |
| 001 | P002 | 2 |
| 001 | P003 | 1 |

**商品テーブル**
| 商品ID | 商品名 | 値段 |
|------|------|----|
| P001 | コーヒー | 500 |
| P002 | カップ | 300 |
| P003 | スプーン | 100 |

✅ **主キー（注文ID, 商品ID）に対する部分関数従属性を解消**

---

#### **第3正規形（3NF）**
【さらにデータを整理】

**注文テーブル**
| 注文ID | 商品ID | 個数 |
|--------|------|----|
| 001 | P001 | 1 |
| 001 | P002 | 2 |
| 001 | P003 | 1 |

**商品テーブル**
| 商品ID | 商品名 | 価格 | カテゴリID |
|------|------|----|----|
| P001 | コーヒー | 500 | C001 |
| P002 | カップ | 300 | C002 |
| P003 | スプーン | 100 | C002 |

**カテゴリテーブル**
| カテゴリID | カテゴリ名 |
|----|------|
| C001 | 飲料 |
| C002 | 生活用品 |

✅ **推移的関数従属性を解消（商品テーブル内のカテゴリ名を別テーブルへ分割）**

---

### **正規化のメリットとデメリット**
| **メリット** | **デメリット** |
|-------------|-------------|
| データの**重複を削減**し、無駄を省ける | テーブル数が増え、**結合（JOIN）処理が増加**し、クエリが複雑化 |
| データの整合性が保たれる | すべての正規形を適用すると**処理が遅くなる**可能性がある |
| 更新や削除時の**整合性が向上** | 分割しすぎると管理が大変になる |

---

### **まとめ**
✅ **第3正規形（3NF）** まで適用すれば、多くのケースでデータの整合性が保たれる！  
✅ **BCNF 以上** は高度な要件が求められる場合に適用する！  
✅ **パフォーマンスと正規化のバランスが重要**（場合によっては正規化をしすぎない方が良い）

