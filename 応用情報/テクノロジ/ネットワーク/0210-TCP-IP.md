# TCP/IPに関する基礎知識

## 1. TCP/IPとは？
TCP/IP（Transmission Control Protocol / Internet Protocol）は、インターネットやローカルネットワークでデータをやり取りするための通信プロトコルのセット。

### **TCP（Transmission Control Protocol）**
- データの送受信を信頼性の高いものにする。
- **特徴**
  - コネクション型の通信（接続を確立してからデータを送る）
  - データの順序を保証
  - パケットの紛失時に再送要求（再送制御）
  - フロー制御・輻輳制御を行う

### **IP（Internet Protocol）**
- データを適切な宛先へルーティングする。
- **特徴**
  - コネクションレス型通信（接続を確立せずにデータを送る）
  - データの到達保証なし
  - 経路の選択（ルーティング）を担当

## 2. TCP/IPの4階層モデル
TCP/IPモデルは、データ通信を分かりやすく整理するために4つの階層に分かれている。

| 階層         | 役割                                | 主なプロトコル |
|-------------|--------------------------------|-------------|
| ~7.アプリケーション層 | ユーザーが利用するアプリをサポート  | HTTP, FTP, SMTP, DNS |
| 4.トランスポート層 | データの送受信を管理              | TCP, UDP |
| 3.インターネット層 | IPアドレスを用いた通信・ルーティング | IP, ICMP, ARP, RIP |
| 1~2.ネットワークインターフェース層 | 物理的なデータ転送 | Ethernet, Wi-Fi, PPP |


### **各階層の詳細**
- **アプリケーション層**
  - ユーザーに直接サービスを提供。
  - Webページの閲覧（HTTP）、メール送受信（SMTP, IMAP, POP3）など。
- **トランスポート層**
  - アプリケーション間のデータ通信を制御。
  - TCP（信頼性あり）、UDP（信頼性なしだが高速）
- **インターネット層**
  - データを宛先へ転送。
  - ルーティング機能を持つ。
- **ネットワークインターフェース層**
  - 物理的なネットワークを通じてデータを転送。
  - MACアドレスを使用。

- TCPのコネクションを識別するためには、次の4つの要素が必要です。
  - 送信元IPアドレス（Source IP Address）
  - 送信元ポート番号（Source Port）
  - 宛先IPアドレス（Destination IP Address）
  - 宛先ポート番号（Destination Port）

## 3. IPアドレスとサブネットマスク

### **IPアドレス**
IPアドレスはネットワーク上の機器を識別するための番号。

- **IPv4**：32ビット（例: 192.168.1.1）
  - 4つのオクテット（8ビット × 4）
  - 0〜255の範囲
- **IPv6**：128ビット（例: 2001:db8::1）
  - 16進数表記
  - 省略可能なルールあり（連続するゼロを `::` に短縮）

### **サブネットマスク**
ネットワークアドレスとホストアドレスを区別するための値。
- 例: `255.255.255.0` → `192.168.1.X` の範囲を同じネットワークとみなす。
- `/24` というCIDR表記でも表される。

### **クラス別IPアドレスの範囲**
| クラス | 範囲 | 用途 |
|--------|------------------|-----------------|
| A      | 1.0.0.0 - 126.255.255.255 | 大規模ネットワーク |
| B      | 128.0.0.0 - 191.255.255.255 | 中規模ネットワーク |
| C      | 192.0.0.0 - 223.255.255.255 | 小規模ネットワーク |
| D      | 224.0.0.0 - 239.255.255.255 | マルチキャスト |
| E      | 240.0.0.0 - 255.255.255.255 | 研究用 |

### **プライベートIPアドレス**
インターネットに直接接続できないLAN内専用のIPアドレス。
- `10.0.0.0/8`
- `172.16.0.0/12`
- `192.168.0.0/16`

### **グローバルIPアドレス**
インターネット上で一意に割り当てられるIPアドレス。


## 4. ルーティング
ルーティングは、ネットワーク間でパケットを転送するための経路制御。

### **ルーティングの種類**
- **静的ルーティング**：手動設定。
- **動的ルーティング**：ルータが自動で最適経路を決定。

### **主要なルーティングプロトコル**
- **RIP**（距離ベースのシンプルなルーティング）
- **OSPF**（帯域幅を考慮し最適経路を選択）
- **BGP**（インターネットの経路制御）

## 5. TCPのフロー制御と輻輳制御

### **フロー制御**
受信側の処理能力に合わせてデータ送信を調整。
- **ウィンドウ制御**：受信バッファのサイズを考慮。

### **輻輳制御**
ネットワークの混雑を防ぐ。
- **スロースタート**：送信速度を徐々に増加。
- **輻輳回避**：ネットワーク混雑時に送信速度を抑制。

### **スリーウェイハンドシェイク（TCP接続確立）**
1. クライアント → SYN → サーバ
2. サーバ → SYN-ACK → クライアント
3. クライアント → ACK → サーバ

## 6. ネットワークセキュリティ

### **ファイアウォール**
不正な通信を防ぐ。
- **パケットフィルタリング**：IPやポートで制御。
- **アプリケーション層フィルタリング**：HTTP, FTPの通信を監視。

### **NAT（Network Address Translation）**
プライベートIPとパブリックIPを変換。

### **VPN（Virtual Private Network）**
安全な通信を確立。
- **IPsec**（IPレイヤーで暗号化）
- **SSL/TLS**（Web通信の暗号化）

### **DDoS攻撃（分散型サービス拒否攻撃）**
大量のトラフィックでサーバを停止させる攻撃。

### **MITM攻撃（中間者攻撃）**
通信の盗聴・改ざん。
- **対策**：SSL/TLS暗号化。
